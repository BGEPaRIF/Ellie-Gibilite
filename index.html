<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Outil d'√âligibilit√© - BGE PaRIF</title>

  <!-- React (global) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel (pour JSX dans un fichier HTML) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Police -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; }

    input[type="text"],
    input[type="number"]{
      border-color: #d1d5db; /* gris clair */
    }
    input[type="text"]:focus,
    input[type="number"]:focus{
      border-color: #00a3da;
      outline: none;
      box-shadow: 0 0 0 1px #00a3da;
    }
    
    .input-error {
      border-color: #dc2626 !important;
      box-shadow: 0 0 0 1px #dc2626;
    }

    .radio-custom {
    appearance: none;
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border: 2px solid #9ca3af; /* gris non coch√© */
    border-radius: 50%;
    display: grid;
    place-content: center;
    background: white;
    cursor: pointer;
  }

  .radio-custom::before {
    content: "";
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: #00a3da; /* üéØ TON BLEU EXACT */
    transform: scale(0);
    transition: transform 0.15s ease-in-out;
  }

  .radio-custom:checked {
    border-color: #00a3da;
  }

  .radio-custom:focus,
.checkbox-outline:focus{
  outline: none;
  box-shadow: 0 0 0 2px rgba(0,163,218,.35);
}

  .radio-custom:checked::before {
    transform: scale(1);
  }
  
    .checkbox-outline{
  appearance: none;
  -webkit-appearance: none;
  width: 20px;
  height: 20px;
  border: 2px solid #9ca3af;   /* gris au repos */
  border-radius: 6px;
  background: white;
  display: grid;
  place-content: center;
  cursor: pointer;
}

.checkbox-outline::after{
  content: "";
  width: 10px;
  height: 6px;
  border-left: 3px solid #00a3da;
  border-bottom: 3px solid #00a3da;
  transform: rotate(-45deg) scale(0);
  transition: transform 0.12s ease-in-out;
}

.checkbox-outline:checked{
  border-color: #00a3da;
}

.checkbox-outline:checked::after{
  transform: rotate(-45deg) scale(1);
}
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const PRIMARY_COLOR = "#00a3da";
    const PRIMARY_BG = "#e0f5fb"; // version tr√®s claire du bleu pour le fond s√©lectionn√©
    const { useState, useMemo } = React;

    // Rend URLs (http/https) + emails cliquables
    function ClickableText({ text }) {
      if (!text) return null;

      // Regex "match" (ok avec /g)
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      const emailRegex = /([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9_-]+)/g;

      // 1) Split sur les URLs
      const urlParts = String(text).split(urlRegex);

      const withUrls = urlParts.map((part, i) => {
        // Ici on ne fait PAS urlRegex.test(part) (bug avec /g)
        const isUrl = part.startsWith("http://") || part.startsWith("https://");

        if (isUrl) {
          return (
            <a
              key={`url-${i}`}
              href={part}
              target="_blank"
              rel="noopener noreferrer"
              className="text-blue-600 hover:text-blue-800 underline inline-flex items-center"
            >
              {part} <span className="ml-1">‚Üó</span>
            </a>
          );
        }
        return part;
      });

      // 2) Pour chaque morceau non-URL, split sur les emails
      const finalParts = withUrls.flatMap((node, idx) => {
        if (typeof node !== "string") return [node];

        const emailParts = node.split(emailRegex);

        return emailParts.map((seg, j) => {
          const looksLikeEmail =
            seg.includes("@") && seg.includes(".") && !seg.includes(" ");

          if (looksLikeEmail && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(seg)) {
            return (
              <a
                key={`email-${idx}-${j}`}
                href={`mailto:${seg}`}
                className="text-blue-600 hover:text-blue-800 underline"
              >
                {seg}
              </a>
            );
          }

          return seg;
        });
      });

      return <>{finalParts}</>;
    }

    function EligibilityTool() {
      const [step, setStep] = useState(0);
      const [answers, setAnswers] = useState({});
      const [results, setResults] = useState(null);
      const [errors, setErrors] = useState({});

      const getQuestions = () => {
        const q = [];

        // 1) Projet / entreprise
        q.push({
          id: "entrepriseCreee",
          question: "Avez-vous d√©j√† cr√©√© votre entreprise ?",
          type: "radio",
          options: ["Oui", "Non"],
        });

        if (answers.entrepriseCreee === "Oui") {
          q.push({
            id: "typeEntreprise",
            question: "Quel est le statut juridique de votre entreprise ?",
            type: "radio",
            options: ["Micro-entreprise", "Entreprise ou Soci√©t√© (EURL, SAS, etc.)"],
          });

          q.push({
            id: "ageEntreprise",
            question: "Depuis combien de temps existe-t-elle ?",
            type: "radio",
            options: ["Moins de 3 ans", "Plus de 3 ans"],
          });

          // IMPORTANT: On ne demande le CA que si Entreprise ou Soci√©t√©
          if (answers.typeEntreprise === "Entreprise ou Soci√©t√© (EURL, SAS, etc.)") {
            q.push({
              id: "caAnnuel",
              question: "Quel est votre chiffre d'affaires annuel ?",
              type: "radio",
              options: ["Moins de 30 000 ‚Ç¨", "Plus de 30 000 ‚Ç¨"],
            });
          }
        }

        if (answers.entrepriseCreee === "Non") {
          q.push({
            id: "stadeProjet",
            question: "√Ä quel stade en est votre projet ?",
            type: "radio",
            options: ["Id√©e", "Projet formalis√©", "Business plan finalis√©"],
          });

          if (answers.stadeProjet === "Projet formalis√©") {
            q.push({
              id: "projetImpact",
              question:
                "Votre projet est-il consid√©r√© comme projet √† impact (social et/ou environnemental) ?",
              type: "radio",
              options: ["Oui", "Non"],
            });
          }

          if (
            answers.stadeProjet === "Projet formalis√©" ||
            answers.stadeProjet === "Business plan finalis√©"
          ) {
            q.push({
              id: "activiteReglementee",
              question:
                "Votre projet concerne-t-il l'une des activit√©s suivantes : activit√© lib√©rale r√©glement√©e ou assimil√©e, activit√©s immobili√®res, secteur m√©dical et m√©dico-social, activit√©s financi√®res et d'assurance, production agricole primaire, p√™che, aquaculture, sylviculture ?",
              type: "radio",
              options: ["Oui", "Non"],
            });
          }
        }

        // 2) Infos perso
        q.push({
          id: "sexe",
          question: "Vous √™tes :",
          type: "radio",
          options: ["Une femme", "Un homme"],
        });

        q.push({
          id: "age",
          question: "Quel est votre √¢ge ?",
          type: "number",
          placeholder: "Ex: 30",
        });

        const age = parseInt(answers.age, 10) || 0;
        if (age >= 18 && age <= 30) {
          q.push({
            id: "missionLocale",
            question: "√ätes-vous inscrit(e) aupr√®s d'une Mission Locale ?",
            type: "radio",
            options: ["Oui", "Non"],
          });
        }

        q.push({
          id: "codePostal",
          question: "Quel est votre code postal de r√©sidence ?",
          type: "text",
          placeholder: "Ex: 75001",
        });

        // QPV : uniquement le message üí° (pas de lien additionnel)
        q.push({
          id: "qpv",
          question:
            "R√©sidez-vous en Quartier Prioritaire de la Ville (QPV) ou dans un rayon de 300 m√®tres autour ?",
          type: "radio",
          options: ["Oui", "Non", "Je ne sais pas"],
          info: "Vous pouvez v√©rifier votre adresse sur https://sig.ville.gouv.fr/",
        });

        // 3) Parcours / situation
        q.push({
          id: "niveauEtude",
          question: "Quel est votre niveau d'√©tude ?",
          type: "radio",
          options: ["Inf√©rieur au CAP/BEP", "CAP/BEP", "Baccalaur√©at", "Bac+2 et plus"],
        });

        q.push({
          id: "statut",
          question: "Quel est votre statut actuel ?",
          type: "checkbox",
          options: [
            "Demandeur d'emploi",
            "Salari√© √† temps complet",
            "Salari√© √† temps partiel",
            "B√©n√©ficiaire RSA",
            "B√©n√©ficiaire ASS",
            "B√©n√©ficiaire AAH",
          ],
        });

        if (answers.statut?.includes("Demandeur d'emploi")) {
          q.push({
            id: "dureeDemandeurEmploi",
            question: "Depuis combien de temps √™tes-vous demandeur d'emploi ?",
            type: "radio",
            options: ["Moins de 12 mois", "De 12 √† 24 mois", "Plus de 24 mois"],
          });
        }

        q.push({
          id: "inscritFranceTravail",
          question: "√ätes-vous inscrit(e) √† France Travail ?",
          type: "radio",
          options: ["Oui", "Non"],
        });

        // 4) Crit√®res sp√©cifiques
        q.push({
          id: "criteresSociaux",
          question: "Cochez toutes les situations qui vous concernent :",
          type: "checkbox",
          options: [
            "Parent isol√©",
            "Sans domicile fixe (SDF)",
            "R√©cemment arriv√© en France",
            "Sortant de l'ASE (Aide Sociale √† l'Enfance)",
            "R√©sidence en ZRR (Zone de Revitalisation Rurale)",
            "Aucun de ces crit√®res",
          ],
        });

        q.push({
          id: "handicap",
          question: "√ätes-vous reconnu(e) travailleur(se) en situation de handicap (RQTH) ?",
          type: "radio",
          options: ["Oui", "Non"],
        });

        if (answers.handicap === "Oui") {
          q.push({
            id: "inscritCapEmploi",
            question: "√ätes-vous inscrit(e) √† Cap Emploi ?",
            type: "radio",
            options: ["Oui", "Non"],
          });
        }

        q.push({
          id: "sortieIAE",
          question:
            "√ätes-vous sorti(e) d'un dispositif IAE (Insertion par l'Activit√© √âconomique) depuis moins de 6 mois ?",
          type: "radio",
          options: ["Oui", "Non"],
        });

        // CPF : lien cliquable (https://)
        q.push({
          id: "cpf",
          question: "Disposez-vous de cr√©dits CPF (Compte Personnel de Formation) ?",
          type: "radio",
          options: ["Oui", "Non", "Je ne sais pas"],
          info:
            "Pour le d√©couvrir, connectez-vous √† votre espace personnel sur https://www.moncompteformation.gouv.fr",
        });

        return q;
      };

      const questions = useMemo(() => getQuestions(), [answers]);
      const currentQuestion = questions[step];

      const validateField = (questionId, value) => {
        let error = "";
        
        if (questionId === "age") {
          const age = parseInt(value, 10);
          if (!value) error = "L‚Äô√¢ge est obligatoire.";
          else if (isNaN(age)) error = "L‚Äô√¢ge doit √™tre un nombre.";
          else if (age < 16 || age > 120) error = "Veuillez saisir un √¢ge valide.";
        }

        if (questionId === "codePostal") {
          if (!value) error = "Le code postal est obligatoire.";
          else if (!/^\d{5}$/.test(value))
            error = "Le code postal doit contenir 5 chiffres.";
        }

        setErrors((prev) => ({ ...prev, [questionId]: error }));
        return error === "";
      };

      const isAnswered =
        currentQuestion &&
        answers[currentQuestion.id] !== undefined &&
        answers[currentQuestion.id] !== "" &&
        (Array.isArray(answers[currentQuestion.id])
          ? answers[currentQuestion.id].length > 0
          : true);

      const handleAnswer = (questionId, value) => {
        // üîπ R√®gle existante : "Aucun de ces crit√®res"
        if (questionId === "criteresSociaux" && Array.isArray(value)) {
          if (value.includes("Aucun de ces crit√®res") && value.length > 1) {
            value = ["Aucun de ces crit√®res"];
          }
        }
        
        // ‚úÖ 1) On enregistre la r√©ponse
        setAnswers((prev) => ({ ...prev, [questionId]: value }));

        // ‚úÖ 2) Optionnel : on efface l'erreur affich√©e d√®s que l'utilisateur retape
        setErrors((prev) => ({ ...prev, [questionId]: "" }));

        // ‚úÖ 3) Validation live pour √¢ge + code postal
        if (questionId === "age" || questionId === "codePostal") {
          validateField(questionId, value);
        }
      };

      const calculateEligibility = () => {
        const eligible = [];
        const a = answers;

        const age = parseInt(a.age, 10) || 0;

        const isQPV = a.qpv === "Oui" || a.qpv === "Je ne sais pas";
        const isDept75 = (a.codePostal || "").startsWith("75");
        const isDept93 = (a.codePostal || "").startsWith("93");
        const isIDF = ["75", "77", "78", "91", "92", "93", "94", "95"].some((d) =>
          (a.codePostal || "").startsWith(d)
        );

        const entrepriseCreee = a.entrepriseCreee === "Oui";
        const isJeune = age >= 18 && age <= 30;
        const isSenior = age >= 50;

        const isRSA = a.statut?.includes("B√©n√©ficiaire RSA");
        const isASS = a.statut?.includes("B√©n√©ficiaire ASS");
        const isAAH = a.statut?.includes("B√©n√©ficiaire AAH");
        const isDemandeurEmploi = a.statut?.includes("Demandeur d'emploi");
        const isSalariePleinTemps = a.statut?.includes("Salari√© √† temps complet");

        const isDETLD = a.dureeDemandeurEmploi === "Plus de 24 mois";
        const isDELD = a.dureeDemandeurEmploi === "De 12 √† 24 mois";

        const niveauEtudeInferieur = ["Inf√©rieur au CAP/BEP", "CAP/BEP"].includes(a.niveauEtude);

        const codesPostIncubatest = [
          "95400","95500","95720","95380","77410","77290","77230","95440","95190","95470","95140","77990","95670",
          "77280","95700","95200","77270","91120","91140","91160","91190","91300","91310","91320","91360","91370",
          "91400","91430","91440","91460","91620","91940","91800","91860","91560","91210","91480","91270","91330",
          "75001","75002","75003","75004","75005","75006","75007","75008","75009","75010","75011","75012","75013",
          "75014","75015","75016","75017","75018","75019","75020"
        ];
        const isVilleIncubatest = codesPostIncubatest.includes(a.codePostal);

        // 1. Acc√©l√©rateur √âmergence
        if (
          !entrepriseCreee &&
          (a.stadeProjet === "Id√©e" || a.stadeProjet === "Projet formalis√©") &&
          isQPV &&
          !isSalariePleinTemps
        ) {
          eligible.push({
            nom: "Acc√©l√©rateur √âmergence",
            description:
              "Programme d'accompagnement intensif destin√© aux porteurs de projet au stade de l'id√©e ou du projet, visant √† strucuturer, valider et lancer une activit√© entrepreneuriale en un temps record. (Accompagnement enti√®rement pris en charge)",
            duree: "Environ 200 heures d'accompagnement sur 6 mois",
            contenu: ["Plus de 100 heures de formation", "Accompagnement individuel", "Ateliers collectifs", "Sessions de mise en r√©seau"],
            enSavoirPlus: "https://emergence.bge-parif.com",
            procedure: "Prendre contact avec l'√©quipe Acc√©l√©rateurs par email : accelerateurs@bge-parif.com",
            note: "Dispositif s√©lectif - Une s√©lection est effectu√©e apr√®s √©tude du dossier",
          });
        }

        // 2. Acc√©l√©rateur Cr√©ation Individuelle
        // - Micro-entreprise: pas de condition CA (et pas de question CA)
        // - Entreprise ou Soci√©t√©: CA < 30 000 ‚Ç¨ requis
        if (entrepriseCreee && isQPV) {
          const ageOk = a.ageEntreprise === "Moins de 3 ans";
          const isMicro = a.typeEntreprise === "Micro-entreprise";
          const isSociete = a.typeEntreprise === "Entreprise ou Soci√©t√© (EURL, SAS, etc.)";
          const caOk = isMicro || (isSociete && a.caAnnuel === "Moins de 30 000 ‚Ç¨");

          if (ageOk && caOk) {
            eligible.push({
              nom: "Acc√©l√©rateur Cr√©ation Individuelle",
              description:
                "Programme sur-mesure pour les entrepreneurs en phase de croissance ou de d√©veloppement qui souhaitent structurer leur activit√© et augmenter consid√©rablement leur chiffre d'affaires. (Accompagnement enti√®rement pris en charge)",
              duree: "Environ 250 heures d'accompagnement sur 12 mois",
              contenu: ["Formation", "Accompagnement individuel", "Ateliers collectifs", "Sessions de mise en r√©seau"],
              enSavoirPlus: "https://creation-individuelle.bge-parif.com/",
              procedure: "Prendre contact avec l'√©quipe Acc√©l√©rateurs par email : accelerateurs@bge-parif.com",
              note: "Dispositif s√©lectif - Une s√©lection est effectu√©e apr√®s √©tude du dossier",
            });
          }
        }

        // 3. Formations certifiantes
        if (a.cpf === "Oui" || a.cpf === "Je ne sais pas") {
          eligible.push({
            nom: "Formations Certifiantes",
            description:
              "Formations certifiantes destin√©es aux cr√©ateurs, dirigeants ou repreneurs d'entreprise afin de d√©velopper des comp√©tences entrepreneuriales cl√©s.",
            duree: "Variable selon la formation (de 14h √† 95h)",
            contenu: [
              "CCPE (Construire et Conduire un Projet Entrepreneurial) ‚Äì 95h : Formation compl√®te pour √©tudier la faisabilit√© d'un projet de cr√©ation ou reprise en acqu√©rant une m√©thodologie de conduite de projet",
              "DVRS (D√©veloppez la visibilit√© d'une entreprise sur les r√©seaux sociaux) ‚Äì 14h : Apprenez √† cr√©er un profil, d√©velopper des communaut√©s et g√©rer votre e-r√©putation sur les r√©seaux sociaux",
              "Piloter sa micro-entreprise ‚Äì 21h : Acqu√©rir les comp√©tences pour la gestion et le d√©veloppement d'une micro-entreprise (imposition, cotisations, comptabilit√©, pilotage)",
            ],
            procedure:
              "Participer √† la r√©union d'information en s'inscrivant via https://www.bge-parif.com/agenda/ ou directement prendre RDV avec la responsable des formations : https://calendly.com/bgeparif/conseil-formation-entrepreneurial-1",
            note:
              a.cpf === "Je ne sais pas"
                ? "Connectez-vous sur www.moncompteformation.gouv.fr pour conna√Ætre votre solde."
                : "Ces formations sont finan√ßables par vos cr√©dits CPF.",
          });
        }

        // 4. G√©n√©rateur √† Impact
        if (!entrepriseCreee && a.stadeProjet === "Projet formalis√©" && a.projetImpact === "Oui" && isDept75) {
          eligible.push({
            nom: "G√©n√©rateur √† Impact",
            description:
              "Dispositif d'accompagnement qui permet de confronter vos id√©es avec des experts de la d√©marche entrepreneuriale, d'√©valuer toutes les options pour entreprendre autrement et de structurer votre mod√®le √©conomique et strat√©gie.",
            duree: "Environ 28 heures (avec ateliers tous les 15 jours & des RDV individuels)",
            contenu: ["Ateliers collectifs orient√©s impact", "Rendez-vous individuels avec expert", "Construction du Business model", "√âlaboration d'un plan d'action et d'un pitch-deck"],
            enSavoirPlus: "https://www.bge-parif.com/structurer-votre-projet/incubateur-parisien-le-generateur-a-impact/",
            procedure: "Participer √† la prochaine r√©union d'information en s'inscrivant via https://www.bge-parif.com/agenda/",
          });
        }

        // 5. Incubatest
        if (
          !entrepriseCreee &&
          (a.stadeProjet === "Projet formalis√©" || a.stadeProjet === "Business plan finalis√©") &&
          isVilleIncubatest &&
          a.activiteReglementee === "Non" &&
          !isSalariePleinTemps
        ) {
          eligible.push({
            nom: "Incubatest",
            description:
              "Les couveuses IncubaTest permettent de tester une activit√© entrepreneuriale dans un cadre s√©curis√©, avec le statut d'entrepreneur √† l'essai.",
            duree: "P√©riode de test de 6 √† 8 mois (avec 15h de RDV individuels & 6 jours de formations)",
            contenu: ["Rendez-vous individuels", "Ateliers et formations op√©rationnelles", "Appui au d√©veloppement commercial, √† la communication et √† la gestion"],
            enSavoirPlus: "https://www.bge-parif.com/tester-votre-activite-en-couveuse-incubatest/",
            procedure: "Participer √† la prochaine r√©union d'information en s'inscrivant via https://www.bge-parif.com/agenda/",
            note: "Sous r√©serve que l'activit√© soit √©ligible. Exclu pour activit√©s r√©glement√©es",
          });
        }

        // 6. Cr√©er Sa R√©ussite
        if (!entrepriseCreee) {
          let criteresN2 = 0;

          const criteresSociaux = a.criteresSociaux || [];
          const has = (x) => criteresSociaux.includes(x);

          if (niveauEtudeInferieur) criteresN2++;
          if (isSenior) criteresN2++;
          if (isDELD) criteresN2++;
          if (isQPV || has("R√©sidence en ZRR (Zone de Revitalisation Rurale)")) criteresN2++;
          if (has("Sans domicile fixe (SDF)")) criteresN2++;
          if (has("Parent isol√©")) criteresN2++;
          if (has("R√©cemment arriv√© en France")) criteresN2++;

          const porte1 = (isRSA || isASS || isAAH) || isDETLD;
          const porte2 = criteresN2 >= 3;
          const porte3 = isJeune && (a.missionLocale === "Oui" || has("Sortant de l'ASE (Aide Sociale √† l'Enfance)") || criteresN2 >= 1);
          const porte4 = a.handicap === "Oui" && (a.inscritCapEmploi === "Oui" || criteresN2 >= 1);
          const porte5 = a.sortieIAE === "Oui";

          if (porte1 || porte2 || porte3 || porte4 || porte5) {
            eligible.push({
              nom: "Cr√©er Sa R√©ussite",
              description:
                "Programme d'accompagnement personnalis√© visant √† am√©liorer l'acc√®s √† la cr√©ation ou √† la reprise d'entreprise, en adaptant le parcours aux besoins du b√©n√©ficiaire.",
              duree: "Jusqu'√† 10h d'accomapgnement individuel ou collectif",
              contenu: ["Entretiens individuels", "Ateliers collectifs", "Compl√©ment ou prolongation d'un parcours existant"],
              enSavoirPlus: "https://www.bge-parif.com/structurer-votre-projet/creer-sa-reussite/",
              procedure: "Contacter BGE PaRIF par email (contact@bge-parif.com) ou par t√©l√©phone (01 43 55 09 48)",
            });
          }
        }

        // 7. PDI 75
        if ((isRSA || isASS) && isDETLD && isDept75 && !entrepriseCreee) {
          eligible.push({
            nom: "PDI 75",
            description:
              "Programme d√©partemental d'insertion visant √† faciliter l'acc√®s √† l'emploi et √† la cr√©ation d'entreprise pour les b√©n√©ficiaires du dispositif",
            duree: "Entre 7 √† 8 heures d'accompagnement",
            contenu: ["Accompagnement individuel par un conseiller expert en cr√©ation d'entreprise"],
            procedure: "Se rapprocher de son conseiller insertion ou France Travail OU contacter BGE PaRIF par mail (contact@bge-parif.com) ou par t√©l√©phone (01 43 55 09 48)",
          });
        }

        // 8. PDI 93
        if ((isRSA || isASS) && isDETLD && isDept93 && !entrepriseCreee) {
          eligible.push({
            nom: "PDI 93",
            description:
              "Programme d√©partemental d'insertion visant √† faciliter l'acc√®s √† l'emploi et √† la cr√©ation d'entreprise pour les b√©n√©ficiaires du dispositif",
            duree: "Entre 7 √† 8 heures d'accompagnement",
            contenu: ["Accompagnement individuel par un conseiller expert"],
            procedure: "Se rapprocher de son conseiller insertion ou France Travail OU contacter BGE PaRIF par mail (contact@bge-parif.com) ou par t√©l√©phone (01 43 55 09 48)",
          });
        }

        // 9. Accompagnement Renforc√©
        if (!entrepriseCreee && (a.stadeProjet === "Projet formalis√©" || a.stadeProjet === "Business plan finalis√©") && isQPV) {
          eligible.push({
            nom: "Accompagnement Renforc√©",
            description:
              "ispositif visant √† proposer un soutien intensif aux porteurs de projet ou entrepreneurs issus ou implant√©s dans des quartiers prioritaires (QPV) ou zones √©quivalentes.",
            duree: "10 heures d'accompagnement en individuel ou collectif",
            contenu: ["Accompagnement individualis√© renforc√©, √âlaboration du plan d'action", "Strat√©gie commerciale", "Business plan", "Choix juridique", "Gestion d'entreprise", "Outils de financement"],
            procedure: "Contacter BGE PaRIF par email (contact@bge-parif.com) ou par t√©l√©phone (01 43 55 09 48)",
          });
        }

        // 10. AGEFIPH
        if (a.handicap === "Oui" && !entrepriseCreee && a.stadeProjet !== "Id√©e") {
          eligible.push({
            nom: "AGEFIPH",
            description:
              "Accompagnement favorisant la cr√©ation d'entreprise et l'insertion professionnelle des personnes en situation de handicap dans les entreprises.",
            duree: "Phase ante-cr√©ation : jusqu'√† 25h / Phase post-cr√©ation : jusqu'√† 15h sur 3 ans",
            contenu: ["Montage du projet", "D√©marrage de l'activit√©", "Suivi post-cr√©ation"],
            procedure: "Se rapprocher de son conseiller Cap Emploi ou de France Travail en exprimant sa volont√© de b√©n√©ficier du dispositif AGEFIPH",
            note: "Reconnaissance RQTH obligatoire",
          });
        }

        // 11. Pass Entrepreneur #Leader 1
        const exclusLeader1 = (a.sexe === "Un homme" && isSalariePleinTemps && age > 30);
        const activiteExclueLeader = a.activiteReglementee === "Oui";

        if (age >= 18 && isIDF && a.stadeProjet !== "Id√©e" && !entrepriseCreee && !exclusLeader1 && !activiteExclueLeader) {
          eligible.push({
            nom: "Pass Entrepreneur #Leader 1",
            description: "Dispositif d'accompagnement individuel destin√© aux porteurs de projet en phase de cr√©ation.",
            duree: "Entre 3 et 7 heures selon votre profil",
            contenu: ["√âlaboration d'un plan d'action structur√©", "D√©finition de la strat√©gie commerciale et du Business plan", "Choix du statut juridique, fiscal et social", "Fondamentaux de la gestion d'entreprise", "Identification des meilleures solutions de financement"],
            procedure: "Compl√©ter le formulaire : https://airtable.com/appH6ML4Ix5hyPhQQ/shrYF8iz0OnKJMYlC",
            note: "Financ√© par la R√©gion √éle-de-France",
          });
        }

        // 12. Pass Entrepreneur #Leader 3
        if (entrepriseCreee && isIDF && a.ageEntreprise === "Moins de 3 ans" && !activiteExclueLeader) {
          eligible.push({
            nom: "Pass Entrepreneur #Leader 3",
            description: "Dispositif d'accompagnement individuel destin√© aux dirigeants en phase de d√©veloppement.",
            duree: "Entre 3 et 7 heures selon votre profil",
            contenu: ["Pilotage efficace de l'entreprise", "Mise en ≈ìuvre de l'action commercial", "D√©veloppement du r√©seau", "Ma√Ætrise des processus de recrutement", "S√©curisation du d√©veloppement"],
            procedure: "Compl√©ter le formulaire : https://airtable.com/appH6ML4Ix5hyPhQQ/shrQzKhqLuA531uOg",
            note: "Financ√© par la R√©gion √éle-de-France",
          });
        }

        // 13. Activ' Cr√©a √âmergence
        if (a.inscritFranceTravail === "Oui" && isDemandeurEmploi && a.stadeProjet === "Id√©e" && !entrepriseCreee) {
          eligible.push({
            nom: "Activ' Cr√©a √âmergence",
            description:
              "Parcours d'accompagnement personnalis√© qui permet d'explorer la cr√©ation ou reprise comme solution de retour √† l'emploi. Concr√®tement, il aide √† consolider et enrichier une id√©e, √©valuer le profil entrepreneurial et identifier les conditions de r√©ussite du projet.",
            duree: "Environ 2 mois (avec 6 ateliers & RDV individuels) ",
            contenu: ["Entretien Diagnostic", "Ateliers collectifs", "Rendez-vous individuels", "Entretien de bilan"],
            procedure: "Contacter son conseiller France Travail ou s'inscrire directeemnt depuis son espace personnel : https://www.francetravail.fr/accueil/",
          });
        }

        setResults(eligible);
      };

      const handleReset = () => {
        setStep(0);
        setAnswers({});
        setResults(null);
        setErrors({});
      };

      const hasError =
        (currentQuestion.id === "age" && errors.age) ||
        (currentQuestion.id === "codePostal" && errors.codePostal);

      // R√©sultats
      if (results !== null) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-4">
            <div className="max-w-4xl mx-auto">
              <div className="bg-white rounded-2xl shadow-xl p-8">
                <h1 className="text-3xl font-bold text-gray-800 mb-6">
                  R√©sultats de votre √©ligibilit√©
                </h1>

                {results.length === 0 ? (
                  <div className="bg-orange-50 border border-orange-200 rounded-lg p-6 mb-6">
                    <div className="flex items-start gap-3">
                      <div className="text-2xl">‚ö†Ô∏è</div>
                      <div>
                        <h3 className="font-semibold text-orange-800 mb-2">
                          Aucun dispositif identifi√©
                        </h3>
                        <p className="text-orange-700">
                          Selon les informations fournies, aucun dispositif ne correspond exactement √† votre profil.
                          Contactez un conseiller pour une analyse plus fine.
                        </p>
                        <p className="text-orange-700 mt-3">
                          <strong>Contactez BGE PaRIF :</strong><br/>
                          üìß contact@bge-parif.com<br/>
                          üìû 01 43 55 09 48
                        </p>
                      </div>
                    </div>
                  </div>
                ) : (
                  <>
                    <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                      <div className="flex items-center gap-2">
                        <svg
                          className="w-6 h-6 text-green-600 mr-2"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          strokeWidth="2"
                          strokeLinecap="round"
                          strokeLinejoin="round"
                          aria-hidden="true"
                       >
                          <path d="M20 6L9 17l-5-5" />
                       </svg>
                        <p className="text-green-800 font-semibold">
                          Vous √™tes √©ligible √† {results.length} dispositif{results.length > 1 ? "s" : ""} !
                        </p>
                      </div>
                    </div>

                    <div className="space-y-4 mb-8">
                      {results.map((d, index) => (
                        <div key={index} className="bg-white border-2 border-blue-200 rounded-xl p-6 hover:shadow-lg transition-all">
                          <h3 className="text-2xl font-bold text-blue-900 mb-3">{d.nom}</h3>

                          <p className="text-gray-700 leading-relaxed mb-4">{d.description}</p>

                          {d.duree && (
                            <div className="mb-3">
                              <span className="inline-block bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-semibold">
                                ‚è±Ô∏è {d.duree}
                              </span>
                            </div>
                          )}

                          {d.contenu?.length > 0 && (
                            <div className="mb-4">
                              <h4 className="font-semibold text-gray-800 mb-2">üìã Contenu :</h4>
                              <ul className="list-disc list-inside space-y-1 text-gray-600 ml-2">
                                {d.contenu.map((item, i) => <li key={i}>{item}</li>)}
                              </ul>
                            </div>
                          )}

                          {d.enSavoirPlus && (
                            <div className="mb-4">
                              <a
                                href={d.enSavoirPlus}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="inline-flex items-center text-blue-600 hover:text-blue-800 font-semibold"
                              >
                                üîó Pour en savoir plus <span className="ml-1">‚Üó</span>
                              </a>
                            </div>
                          )}

                          {d.procedure && (
                            <div className="mb-4 bg-green-50 border border-green-200 rounded-lg p-4">
                              <h4 className="font-semibold text-green-900 mb-2">üìû Comment s'inscrire :</h4>
                              <div className="text-green-800">
                                <ClickableText text={d.procedure} />
                              </div>
                            </div>
                          )}

                          {d.note && (
                            <div className="bg-amber-50 border border-amber-200 rounded-lg p-3">
                              <p className="text-amber-900 text-sm">
                                <strong> Note :</strong> {d.note}
                              </p>
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  </>
                )}

                <button
                  onClick={handleReset}
                  className="w-full text-white py-3 px-6 rounded-lg font-semibold transition-colors"
                  style={{ backgroundColor: PRIMARY_COLOR }}
                  >
                  üîÑ Recommencer le questionnaire
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Questionnaire
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-4">
          <div className="max-w-3xl mx-auto">
            <div className="bg-white rounded-2xl shadow-xl p-8">
              <h1 className="text-3xl font-bold text-gray-800 mb-2">
                D√©couvrez les dispositifs d'accompagnement faits pour vous !
              </h1>
              <p className="text-gray-600 mb-6">
                En compl√©tant ce formulaire, nous vous aidons √† identifier l'accompagnement le plus adapt√© √† votre situation.
              </p>

              <div className="mb-6">
                <div className="flex justify-between text-sm text-gray-600 mb-2">
                  <span>Question {step + 1} sur {questions.length}</span>
                  <span>{Math.round(((step + 1) / questions.length) * 100)}%</span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div
                    className="h-2 rounded-full transition-all duration-300"
                    style={{ width: `${((step + 1) / questions.length) * 100}%`, backgroundColor: PRIMARY_COLOR, }}
                  ></div>
                </div>
              </div>

              <div className="mb-8">
                <h2 className="text-xl font-semibold text-gray-800 mb-4">
                  {currentQuestion.question}
                </h2>

                {currentQuestion.info && (
                  <div className="mb-4 bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p className="text-sm text-blue-700">
                      üí° <ClickableText text={currentQuestion.info} />
                    </p>
                  </div>
                )}

                {currentQuestion.type === "radio" && (
                  <div className="space-y-3">
                    {currentQuestion.options.map((option) => (
                      <label
                        key={option}
                        className="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"
                        style={{
                          borderColor: answers[currentQuestion.id] === option ? PRIMARY_COLOR : "#e5e7eb",
                          backgroundColor: answers[currentQuestion.id] === option ? PRIMARY_BG : "white",
                        }}
                      >
                        <input
                          type="radio"
                          name={currentQuestion.id}
                          value={option}
                          checked={answers[currentQuestion.id] === option}
                          onChange={(e) => handleAnswer(currentQuestion.id, e.target.value)}
                          className="mr-3 radio-custom"
                        />
                        <span className="text-gray-700 font-medium">{option}</span>
                      </label>
                    ))}
                  </div>
                )}

                {currentQuestion.type === "checkbox" && (
                  <div className="space-y-3">
                    {currentQuestion.options.map((option) => (
                      <label
                        key={option}
                        className="flex items-center p-4 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors"
                        style={{
                          borderColor: answers[currentQuestion.id]?.includes(option) ? PRIMARY_COLOR : "#e5e7eb",
                          backgroundColor: answers[currentQuestion.id]?.includes(option) ? PRIMARY_BG : "white",
                        }}
                      >
                        <input
                          type="checkbox"
                          value={option}
                          checked={answers[currentQuestion.id]?.includes(option) || false}
                          onChange={(e) => {
                            const current = answers[currentQuestion.id] || [];
                            const newValue = e.target.checked
                              ? [...current, option]
                              : current.filter((item) => item !== option);
                            handleAnswer(currentQuestion.id, newValue);
                          }}
                          className="mr-3 checkbox-outline"
                        />
                        <span className="text-gray-700 font-medium">{option}</span>
                      </label>
                    ))}
                  </div>
                )}

                {currentQuestion.type === "text" && (
                  <>
                    <input
                      type="text"
                      placeholder={currentQuestion.placeholder}
                      value={answers[currentQuestion.id] || ""}
                      onChange={(e) => handleAnswer(currentQuestion.id, e.target.value)}
                      inputMode={currentQuestion.id === "codePostal" ? "numeric" : undefined}
                      pattern={currentQuestion.id === "codePostal" ? "\\d*" : undefined}
                      maxLength={currentQuestion.id === "codePostal" ? 5 : undefined}
                      className={`w-full p-4 border-2 rounded-lg text-lg ${
                        currentQuestion.id === "codePostal" && errors.codePostal ? "input-error" : ""
                      }`}
                      />

                    {currentQuestion.id === "codePostal" && errors.codePostal && (
                    <p className="mt-2 text-sm text-red-600">{errors.codePostal}</p>
                  )}
                </>
              )}

              {currentQuestion.type === "number" && (
                <>
                  <input
                    type="number"
                    placeholder={currentQuestion.placeholder}
                    value={answers[currentQuestion.id] || ""}
                    onChange={(e) => handleAnswer(currentQuestion.id, e.target.value)}
                    className={`w-full p-4 border-2 rounded-lg text-lg ${
                      currentQuestion.id === "age" && errors.age ? "input-error" : ""
                    }`}
                  />

                  {currentQuestion.id === "age" && errors.age && (
                  <p className="mt-2 text-sm text-red-600">{errors.age}</p>
                )}
                </>
            )}

              </div>

              <div className="flex gap-4">
                {step > 0 && (
                  <button
                    onClick={() => setStep(step - 1)}
                    className="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                  >
                    ‚Üê Pr√©c√©dent
                  </button>
                )}
                <button
                  onClick={() => {
                    const id = currentQuestion.id;

                    if (id === "age" || id === "codePostal") {
                      const ok = validateField(id, answers[id] || "");
                      if (!ok) return; // bloque si invalide
                    }
                    
                    if (step < questions.length - 1) setStep(step + 1);
                    else calculateEligibility();
                  }}

                  disabled={!isAnswered || hasError}
                  className="flex-1 text-white py-3 px-6 rounded-lg font-semibold transition-colors disabled:cursor-not-allowed"
                  style={{ backgroundColor: (!isAnswered || hasError) ? "#cbd5e1" : PRIMARY_COLOR }}
                >
                  {step === questions.length - 1 ? "Voir les r√©sultats" : "Suivant ‚Üí"}
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<EligibilityTool />);
  </script>
</body>
</html>
